#!/usr/bin/env python3
"""
KEGG Import Diagnostic Guide

This guide helps diagnose why KEGG imports might not render or save models.

Run the application and try to import a KEGG pathway (e.g., "hsa00010").
Then check the console output for these specific messages:
"""

print("=" * 70)
print("KEGG IMPORT DIAGNOSTIC CHECKLIST")
print("=" * 70)
print()
print("After importing a KEGG pathway, look for these messages in the console:")
print()

print("1. IMPORT START:")
print("   [ ] '[KEGG_IMPORT] Starting one-click import for pathway: <id>'")
print("   [ ] '[KEGG_IMPORT] Fetching pathway <id> from KEGG...'")
print()

print("2. FETCH COMPLETION:")
print("   [ ] '[KEGG_IMPORT] ‚úÖ Fetched <id>, now importing...'")
print("   [ ] '[KEGG_IMPORT] üîÑ Converting pathway to Petri net...'")
print()

print("3. CONVERSION:")
print("   [ ] '[KEGG_IMPORT] Conversion complete:'")
print("   [ ] '  - Places: <number>'")
print("   [ ] '  - Transitions: <number>'")
print("   [ ] '  - Arcs: <number>'")
print()

print("4. CANVAS LOADING:")
print("   [ ] '[KEGG_IMPORT] Creating tab for: <pathway name>'")
print("   [ ] '[KEGG_IMPORT] Tab created: page_index=<n>, drawing_area=<object>'")
print("   [ ] '[KEGG_IMPORT] Canvas manager: <object>'")
print()

print("5. OBJECTS LOADING:")
print("   [ ] '[KEGG_IMPORT] Loading objects to canvas...'")
print("   [ ] '[KEGG_IMPORT] Objects loaded successfully!'")
print()

print("6. VERIFICATION:")
print("   [ ] '[KEGG_IMPORT] Verifying loaded objects in manager...'")
print("   [ ] '  manager.places: <number> (should be > 0)'")
print("   [ ] '  manager.transitions: <number> (should be > 0)'")
print("   [ ] '  manager.arcs: <number> (should be > 0)'")
print()

print("7. MODEL AUTO-SAVE:")
print("   [ ] '[KEGG_IMPORT] Auto-saving Petri net model to project/models/...'")
print("   [ ] 'Debug - manager: True'")
print("   [ ] 'Debug - manager.project_manager: True'")
print("   [ ] 'Debug - current_project: True'")
print("   [ ] '[KEGG_IMPORT] Models directory: <path>'")
print("   [ ] '[KEGG_IMPORT] ‚úì Model auto-saved to: <filepath>'")
print()
print("   OR if fails:")
print("   [ ] '[KEGG_IMPORT] ‚úó No project open - skipping model auto-save'")
print("   ‚ö†Ô∏è  If you see this, you need to open a project first!")
print()

print("8. KGML SAVE:")
print("   [ ] '[KEGG_IMPORT] Checking KGML save conditions...'")
print("   [ ] 'Debug - self.project: True'")
print("   [ ] 'Debug - self.current_kgml: True'")
print("   [ ] 'Debug - self.current_pathway: True'")
print("   [ ] '[KEGG_IMPORT] ‚úì Saved KGML to: pathways/<filename>'")
print()

print("9. CANVAS RENDERING:")
print("   [ ] '[KEGG_IMPORT] Triggering canvas redraw...'")
print("   [ ] 'Debug - drawing_area: <object> (should not be None)'")
print("   [ ] '[KEGG_IMPORT] ‚úì queue_draw() called successfully'")
print()

print("10. FINAL STATUS:")
print("   [ ] '[KEGG_IMPORT] ‚úÖ Import complete: <N> places, <N> transitions, <N> arcs'")
print("   [ ] 'Final verification:'")
print("   [ ] '  - Tab created: Yes'")
print("   [ ] '  - Objects loaded: <N> total'")
print("   [ ] '  - Canvas redraw triggered: Yes'")
print()

print("=" * 70)
print("COMMON ISSUES AND SOLUTIONS")
print("=" * 70)
print()

print("ISSUE 1: 'No project open - skipping model auto-save'")
print("SOLUTION: You must open or create a project BEFORE importing")
print("  1. File ‚Üí Open Project (or create new project)")
print("  2. Then try KEGG import again")
print()

print("ISSUE 2: 'Debug - manager.project_manager: False'")
print("SOLUTION: Canvas manager not properly initialized")
print("  1. Check if model canvas is visible")
print("  2. Try creating a new document first")
print("  3. Then try KEGG import")
print()

print("ISSUE 3: Objects loaded but not visible")
print("SOLUTION: Rendering issue")
print("  1. Check if drawing_area is valid (not None)")
print("  2. Check if queue_draw() was called")
print("  3. Try manually zooming out (Ctrl+Scroll)")
print("  4. Try switching tabs and back")
print()

print("ISSUE 4: 'ERROR: model_canvas is None!'")
print("SOLUTION: Model canvas not available")
print("  1. Ensure canvas panel is visible")
print("  2. Try restarting application")
print("  3. Check if canvas initialization succeeded")
print()

print("ISSUE 5: Zero objects loaded (Places: 0, Transitions: 0)")
print("SOLUTION: Conversion failed")
print("  1. Check for conversion errors in earlier messages")
print("  2. Verify pathway ID is correct (e.g., 'hsa00010')")
print("  3. Check network connection for API access")
print()

print("=" * 70)
print("TESTING STEPS")
print("=" * 70)
print()
print("1. Start the application")
print("2. Open/Create a project (File ‚Üí Open Project)")
print("3. Go to Pathway panel ‚Üí KEGG tab")
print("4. Enter pathway ID: hsa00010")
print("5. Click Import")
print("6. Watch console for the checklist above")
print("7. Look for any '‚úó' or 'ERROR' messages")
print("8. Check if:")
print("   - A new tab appeared with the pathway name")
print("   - The canvas shows circles and rectangles")
print("   - File saved to project/models/hsa00010.shy")
print("   - File saved to project/pathways/hsa00010.kgml")
print()

print("=" * 70)
print("QUICK DIAGNOSTIC")
print("=" * 70)
print()
print("After import, run these checks:")
print()
print("Console output:")
print("  grep -E '\\[KEGG_IMPORT\\]' <console_output> | tail -50")
print()
print("Files created:")
print("  ls -lh workspace/projects/<PROJECT_NAME>/models/")
print("  ls -lh workspace/projects/<PROJECT_NAME>/pathways/")
print()
print("=" * 70)
